<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    
    
    <title>Login to Krusty</title>
    
    
    <script src="assets/js/jquery.min.js"></script> 
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script defer src="assets/js/upload.js"></script>
    <script src="assets/package/dist/Chart.min.js"></script>
    <script src="assets/air-datepicker-master/dist/js/datepicker.min.js"></script>

    <!-- Include English language -->
    <script src="assets/air-datepicker-master/dist/js/i18n/datepicker.en.js"></script>
    
    <script>
         $(document).ready(function(){
            $('#navguest').load("nav/nav-user.html");
            $('#footer').load("footer/footer-user.html");
            $('#favicon').load("favicon.html");
         });
    </script>
   
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oleo+Script">
    <link rel="stylesheet" href="assets/css/Footer-Basic.css">
    <link rel="stylesheet" href="assets/css/Navigation-with-Button.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css//uploadstyle.css"> 


    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">

    <link href="assets/air-datepicker-master/dist/css/datepicker.min.css" rel="stylesheet" type="text/css">
    
  
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>




    

    <div id = "favicon" > </div>
</head>

<body>
    <div id = "navguest"> </div>
    <center>
        <form class="uploadArea">
            <h1>Select a File to Upload</h1> <br>
            <input type="file" id="selectFiles" value = "Import" accept=".json"> <br> <br>
            <input type="button" id="import" value="Upload">
            <input type="button" id="cancelUpload" value="Cancel">
        </form>


        <div id = "chartType"></div>

        <div class = "container" id = "datadisplay">
            <div id = "dp" data-language='en'>
            </div>
            <canvas id=  "summary"> </canvas>
        </div>


    </center>

       
        <script>
            document.getElementById('import').onclick = function() {
                var files = document.getElementById('selectFiles').files;
                console.log(files);
                if (files.length <= 0) {
                    return false;
                }

                var fr = new FileReader();
                
              
                fr.onload = function(e) {

                    
                    console.log(e);
                    var result = JSON.parse(e.target.result);
                    var formatted = JSON.stringify(result, null, 2);

                    var allNames = result.sales;
                    var customerIDs = Object.keys(allNames);

                    var customers = [];

                    
                    for(var i = 0; i < customerIDs.length; i++){
                        var custID = allNames[customerIDs[i]];
                        var customer = {customerNum: custID};

                        var customerInfo = [];

                        customerInfo.push(customerIDs[i]);
                        customerInfo.push(customer.customerNum["datetime"]);
                        customerInfo.push(customer.customerNum["burger"]);
                        customerInfo.push(customer.customerNum["species"]);
                        customers.push(customerInfo);
                    }

                    document.getElementById("chartType").innerHTML = "";

                    var genSales = document.createElement("BUTTON");
                    genSales.innerHTML = "All Sales";
                    document.getElementById("chartType").appendChild(genSales);

                    var burgSales = document.createElement("BUTTON");
                    burgSales.innerHTML = "Burger Sales";
                    document.getElementById("chartType").appendChild(burgSales);

                    var specSales = document.createElement("BUTTON");
                    specSales.innerHTML = "Species Sales";
                    document.getElementById("chartType").appendChild(specSales);

                    var BurgBySpec = document.createElement("BUTTON");
                    BurgBySpec.innerHTML = "Burger By Species";
                    document.getElementById("chartType").appendChild(BurgBySpec);

                    var salesByHour = document.createElement("BUTTON");
                    salesByHour.innerHTML = "Total Sales By Hour";
                    document.getElementById("chartType").appendChild(salesByHour);

                    var salesByDay = document.createElement("BUTTON");
                    salesByDay.innerHTML = "Total Sales By Day";
                    document.getElementById("chartType").appendChild(salesByDay);

                    var salesByHourOfDay = document.createElement("BUTTON");
                    salesByHourOfDay.innerHTML = "Day Sales By Hour";
                    document.getElementById("chartType").appendChild(salesByHourOfDay);


                    var barChart = null;


                    function resetData () {
                       
                        if(barChart!= null) {
                            barChart.destroy();
                        }


                        var container = document.getElementById("datadisplay");
                        if (container.contains(document.getElementById('salesTableDiv'))) {
                            var element = document.getElementById("salesTableDiv");
                            element.parentNode.removeChild(element);
                        }
                        
                        $('#dp').datepicker().data('datepicker').destroy();
        
                        
                    }

                    renderDatePicker();
                    
                    function renderGenSales () {

                        resetData();

                        var container = document.getElementById("datadisplay");


                        if (!container.contains(document.getElementById('salesTable'))) {

                            var div = document.createElement('div');
                            div.id = 'salesTableDiv';
                            div.style.padding = '10px 0px 10px 0px';
                            
                            var tbl = document.createElement('table');
                            tbl.id = 'salesTable'
                            tbl.style.width = '100%';

                            container.prepend(div);
                            div.append(tbl);
                        }

                        

                        $(document).ready(function() {
                            $('#salesTable').DataTable( {
                                data: customers,
                                columns: [
                                    { title: "ID" },
                                    { title: "Date and Time" },
                                    { title: "Burger" },
                                    { title: "Species" }
                                ]
                            } );
                        } );


                    }


                    function renderBurgSales () {

                        resetData();

                        var burgersales = result["burger_sales"];
                        var burgersalesQty = [burgersales["Krusty Combo"], burgersales["Krusty Deluxe"], burgersales["Krabby Pattie"]];
                        console.log(burgersalesQty);


                        let myChart = document.getElementById('summary').getContext('2d'); 

                        barChart = new Chart(myChart, {
                            type:'bar',
                            data: {
                                labels: ['Krusty Combo', 'Krusty Deluxe', 'Krabby Pattie'],
                                datasets: [{
                                    label: 'Burger Sales',
                                    data: burgersalesQty
                                }]
                            },
                            options: {}
        
                        });
                    }


                    function renderSpecSales () {

                        resetData();

                        var species_sales = result["species_sales"];
                        var salesBySpecies = [species_sales["leatherback turtle"], species_sales["salmon"], species_sales["seahorse"], species_sales["coral"],
                                            species_sales["giant clam"], species_sales["gray whale"], species_sales["sea lion"]];
                        console.log(salesBySpecies);


                        let myChart = document.getElementById('summary').getContext('2d');

                        barChart = new Chart(myChart, {
                            type:'bar',
                            data: {
                                labels: ['Leatherback Turtle', 'Salmon', 'Seahorse', 'Coral', 'Giant Clam', 'Gray Whale', 'Sea Lion'],
                                datasets: [{
                                    label: 'Species Sales',
                                    data: salesBySpecies
                                }]
                            },
                             options: {}
    
                        });

                    }

                    function renderBurgBySpec () {

                        resetData();

                        var burger_by_species = result["burger_by_species"];

                        var combo_Byspecies = burger_by_species["Krusty Combo"];
                        var pattie_Byspecies = burger_by_species["Krabby Pattie"];
                        var deluxe_Byspecies = burger_by_species["Krusty Deluxe"];

                        var combo_sales_species = [combo_Byspecies["leatherback turtle"], combo_Byspecies["salmon"], combo_Byspecies["seahorse"], combo_Byspecies["coral"],
                                                    combo_Byspecies["giant clam"], combo_Byspecies["gray whale"], combo_Byspecies["sea lion"]];
                        var pattie_sales_species = [pattie_Byspecies["leatherback turtle"], pattie_Byspecies["salmon"], pattie_Byspecies["seahorse"], pattie_Byspecies["coral"],
                                                    pattie_Byspecies["giant clam"], pattie_Byspecies["gray whale"], pattie_Byspecies["sea lion"]];
                        var deluxe_sales_species = [deluxe_Byspecies["leatherback turtle"], deluxe_Byspecies["salmon"], deluxe_Byspecies["seahorse"], deluxe_Byspecies["coral"],
                                                    deluxe_Byspecies["giant clam"], deluxe_Byspecies["gray whale"], deluxe_Byspecies["sea lion"]];

                        console.log(combo_sales_species);
                        console.log(pattie_sales_species);
                        console.log(deluxe_sales_species);



                        var comboDataset = {
                                    label: 'Krusty Combo Sales',
                                    data: combo_sales_species,
                                    backgroundColor: 'rgba(0, 99, 132, 0.6)'

                        };

                        var deluxeDataset = {
                                    label: 'Krusty Deluxe Sales',
                                    data: deluxe_sales_species,
                                    backgroundColor: 'rgba(99, 132, 0, 0.6)'
                        };

                        var pattieDataset = {
                                    label: 'Krabby Pattie Sales',
                                    data: pattie_sales_species,
                                    backgroundColor: 'rgba(0, 99, 0, 0.6)'
                        };

                        

                        let myChart = document.getElementById('summary').getContext('2d');

                        barChart = new Chart(myChart, {
                            type:'bar',
                            data: {
                                labels: ['Leatherback Turtle', 'Salmon', 'Seahorse', 'Coral', 'Giant Clam', 'Gray Whale', 'Sea Lion'],
                                datasets: [comboDataset, deluxeDataset, pattieDataset]
                            },
                             options: {}
    
                        });
                    }

                    function renderSalesByHour () {

                        resetData();

                        var nCusPerHour;

                        var am1 = 0;
                        var am2 = 0;
                        var am3 = 0;
                        var am4 = 0;
                        var am5 = 0;
                        var am6 = 0;
                        var am7 = 0;
                        var am8 = 0;
                        var am9 = 0;
                        var am10 = 0;
                        var am11 = 0;
                        var pm12 = 0;

                        var pm1 = 0;
                        var pm2 = 0;
                        var pm3 = 0;
                        var pm4 = 0;
                        var pm5 = 0;
                        var pm6 = 0;
                        var pm7 = 0;
                        var pm8 = 0;
                        var pm9 = 0;
                        var pm10 = 0;
                        var pm11 = 0;
                        var am12 = 0;


                        for (var i = 0; i< customers.length; i++) {
                            var date = new Date(customers[i][1]);

                            if (date.getHours() == 0) {
                                am12++;
                            }
                            else if (date.getHours() == 1) {
                                am1++;
                            }
                            else if (date.getHours() == 2) {
                                am2++;
                            }
                            else if (date.getHours() == 3) {
                                am3++;
                            }
                            else if (date.getHours() == 4) {
                                am4++;
                            }
                            else if (date.getHours() == 5) {
                                am5++;
                            }
                            else if (date.getHours() == 6) {
                                am6++;
                            }
                            else if (date.getHours() == 7) {
                                am7++;
                            }
                            else if (date.getHours() == 8) {
                                am8++;
                            }
                            else if (date.getHours() == 9) {
                                am9++;
                            }
                            else if (date.getHours() == 10) {
                                am10++;
                            }
                            else if (date.getHours() == 11) {
                                am11++;
                            }
                            else if (date.getHours() == 12) {
                                pm12++;
                            }
                            else if (date.getHours() == 13) {
                                pm1++;
                            }
                            else if (date.getHours() == 14) {
                                pm2++;
                            }
                            else if (date.getHours() == 15) {
                                pm3++;
                            }
                            else if (date.getHours() == 16) {
                                pm4++;
                            }
                            else if (date.getHours() == 17) {
                                pm5++;
                            }
                            else if (date.getHours() == 18) {
                                pm6++;
                            }
                            else if (date.getHours() == 19) {
                                pm7++;
                            }
                            else if (date.getHours() == 20) {
                                pm8++;
                            }
                            else if (date.getHours() == 21) {
                                pm9++;
                            }
                            else if (date.getHours() == 22) {
                                pm10++;
                            }
                            else if (date.getHours() == 23) {
                                pm11++;
                            }

                            nCusPerHour = [am1, am2, am3, am4, am5, am6, am7, am8, am9, am10, am11, pm12,
                             pm1, pm2, pm3, pm4, pm5, pm6, pm7, pm8, pm9, pm10, pm11, pm12];

                        }


                        let myChart = document.getElementById('summary').getContext('2d'); 

                        barChart = new Chart(myChart, {
                            type:'line',
                            data: {
                                labels: ['1:00am', '2:00am', '3:00am', '4:00am', '5:00am', '6:00am', '7:00am', '8:00am', '9:00am', '10:00am', '11:00am', '12:00pm',
                                 '1:00pm', '2:00pm', '3:00pm', '4:00pm', '5:00pm', '6:00pm', '7:00pm', '8:00pm', '9:00pm', '10:00pm', '11:00pm', '12:00am'],
                                datasets: [{
                                    label: 'Total Sales Per Hour of the Day',
                                    data: nCusPerHour
                                }]
                            },
                            options: {}
        
                        });
                    }

                    function renderSalesByDay () {

                        resetData();

                        var nCusPerDay;

                        var monCtr = 0;
                        var tuesCtr = 0;
                        var wedCtr = 0;
                        var thursCtr = 0;
                        var friCtr = 0;
                        var satCtr = 0;
                        var sunCtr = 0;

                        for (var i = 0; i< customers.length; i++) {

                            var date = new Date(customers[i][1]);

                            if (date.getDay() == 0) {
                                sunCtr++;
                            }
                            else if (date.getDay() == 1) {
                                monCtr++;
                            }
                            else if (date.getDay() == 2) {
                                tuesCtr++;
                            }
                            else if (date.getDay() == 3) {
                                wedCtr++;
                            }
                            else if (date.getDay() == 4) {
                                thursCtr++;
                            }
                            else if (date.getDay() == 5) {
                                friCtr++;
                            }
                            else if (date.getDay() == 6) {
                                satCtr++;
                            }
                        
                            nCusPerDay = [sunCtr, monCtr, tuesCtr, wedCtr, thursCtr, friCtr, satCtr];
                        }

                        console.log(nCusPerDay);

                        let myChart = document.getElementById('summary').getContext('2d'); 

                        barChart = new Chart(myChart, {
                            type:'line',
                            data: {
                                labels: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
                                datasets: [{
                                    label: 'Total Sales Per Day of the Week',
                                    data: nCusPerDay
                                }]
                            },
                            options: {}
        
                        });
                        
                    }


                    var dp = null;

                    function renderDatePicker () {

                        resetData();
                        var lastDate = customers[customers.length-1][1];
                        dp = $('#dp').datepicker().data('datepicker');
                        dp.date = new Date(lastDate);
                        dp.selectDate(lastDate);

                        renderSpecificDay(moment(lastDate).format("MM/DD/YYYY"));

                        $("#dp").datepicker({
                            onSelect: function(dateText) {

                                if(barChart!= null) {
                                    barChart.destroy();
                                }

                                renderSpecificDay(dateText);
                            }
                        });

                    }

                    function renderSpecificDay (selectedDate) {

                        if (selectedDate != '') {
                            console.log("Selected date: " + selectedDate);


                            var nCusPerHour;

                            var am1 = 0;
                            var am2 = 0;
                            var am3 = 0;
                            var am4 = 0;
                            var am5 = 0;
                            var am6 = 0;
                            var am7 = 0;
                            var am8 = 0;
                            var am9 = 0;
                            var am10 = 0;
                            var am11 = 0;
                            var pm12 = 0;

                            var pm1 = 0;
                            var pm2 = 0;
                            var pm3 = 0;
                            var pm4 = 0;
                            var pm5 = 0;
                            var pm6 = 0;
                            var pm7 = 0;
                            var pm8 = 0;
                            var pm9 = 0;
                            var pm10 = 0;
                            var pm11 = 0;
                            var am12 = 0;


                            for (var i = 0; i< customers.length; i++) {

                                var date = new Date(customers[i][1]);

                                if (moment(date).format("MM/DD/YYYY") === selectedDate) {

                                    if (date.getHours() == 0) {
                                        am12++;
                                    }
                                    else if (date.getHours() == 1) {
                                        am1++;
                                    }
                                    else if (date.getHours() == 2) {
                                        am2++;
                                    }
                                    else if (date.getHours() == 3) {
                                        am3++;
                                    }
                                    else if (date.getHours() == 4) {
                                        am4++;
                                    }
                                    else if (date.getHours() == 5) {
                                        am5++;
                                    }
                                    else if (date.getHours() == 6) {
                                        am6++;
                                    }
                                    else if (date.getHours() == 7) {
                                        am7++;
                                    }
                                    else if (date.getHours() == 8) {
                                        am8++;
                                    }
                                    else if (date.getHours() == 9) {
                                        am9++;
                                    }
                                    else if (date.getHours() == 10) {
                                        am10++;
                                    }
                                    else if (date.getHours() == 11) {
                                        am11++;
                                    }
                                    else if (date.getHours() == 12) {
                                        pm12++;
                                    }
                                    else if (date.getHours() == 13) {
                                        pm1++;
                                    }
                                    else if (date.getHours() == 14) {
                                        pm2++;
                                    }
                                    else if (date.getHours() == 15) {
                                        pm3++;
                                    }
                                    else if (date.getHours() == 16) {
                                        pm4++;
                                    }
                                    else if (date.getHours() == 17) {
                                        pm5++;
                                    }
                                    else if (date.getHours() == 18) {
                                        pm6++;
                                    }
                                    else if (date.getHours() == 19) {
                                        pm7++;
                                    }
                                    else if (date.getHours() == 20) {
                                        pm8++;
                                    }
                                    else if (date.getHours() == 21) {
                                        pm9++;
                                    }
                                    else if (date.getHours() == 22) {
                                        pm10++;
                                    }
                                    else if (date.getHours() == 23) {
                                        pm11++;
                                    }
                                }


                                nCusPerHour = [am1, am2, am3, am4, am5, am6, am7, am8, am9, am10, am11, pm12,
                                pm1, pm2, pm3, pm4, pm5, pm6, pm7, pm8, pm9, pm10, pm11, pm12];

                            }


                            let myChart = document.getElementById('summary').getContext('2d'); 

                            barChart = new Chart(myChart, {
                                type:'line',
                                data: {
                                    labels: ['1:00am', '2:00am', '3:00am', '4:00am', '5:00am', '6:00am', '7:00am', '8:00am', '9:00am', '10:00am', '11:00am', '12:00pm',
                                    '1:00pm', '2:00pm', '3:00pm', '4:00pm', '5:00pm', '6:00pm', '7:00pm', '8:00pm', '9:00pm', '10:00pm', '11:00pm', '12:00am'],
                                    datasets: [{
                                        label: 'Total Sales Per Hour of the Day on ' + selectedDate,
                                        data: nCusPerHour
                                    }]
                                },
                                options: {}
            
                            });
                        }

                    



                    }



                    genSales.addEventListener('click', renderGenSales);
                    burgSales.addEventListener('click', renderBurgSales);
                    specSales.addEventListener('click', renderSpecSales);
                    BurgBySpec.addEventListener('click', renderBurgBySpec);
                    salesByHour.addEventListener('click', renderSalesByHour);
                    salesByDay.addEventListener('click', renderSalesByDay);
                    salesByHourOfDay.addEventListener('click', renderDatePicker);
                };


                fr.readAsText(files.item(0));


            };

        
        </script>

    
    <div id = "footer"> </div>

</body>

</html>