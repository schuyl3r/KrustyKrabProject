<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    
    
    <title>Login to Krusty</title>
    
    
    <script src="assets/js/jquery.min.js"></script> 
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script defer src="assets/js/upload.js"></script>
    <script src="assets/package/dist/Chart.min.js"></script>
    
    <script>
         $(document).ready(function(){
            $('#navguest').load("nav/nav-user.html");
            $('#footer').load("footer/footer-user.html");
            $('#favicon').load("favicon.html");
         });
    </script>
   
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oleo+Script">
    <link rel="stylesheet" href="assets/css/Footer-Basic.css">
    <link rel="stylesheet" href="assets/css/Navigation-with-Button.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css//uploadstyle.css"> 


    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">
  
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>

    


    <div id = "favicon" > </div>
</head>

<body>
    <div id = "navguest"> </div>
    <center>
        <form class="uploadArea">
            <h1>Select a File to Upload</h1> <br>
            <input type="file" id="selectFiles" value = "Import" accept=".json"> <br> <br>
            <input type="button" id="import" value="Upload">
            <input type="button" id="cancelUpload" value="Cancel">
        </form>



        <div id = "chartType"></div>

        <div class = "container">
            <canvas id=  "summary"> </canvas>
        </div>


    </center>

       
        <script> 
            document.getElementById('import').onclick = function() {
                var files = document.getElementById('selectFiles').files;
                console.log(files);
                if (files.length <= 0) {
                    return false;
                }

                var fr = new FileReader();
                

                fr.onload = function(e) {
                    console.log(e);
                    var result = JSON.parse(e.target.result);
                    var formatted = JSON.stringify(result, null, 2);

                    console.log(result);



                    var genSales = document.createElement("BUTTON");
                    genSales.innerHTML = "All Sales";
                    document.getElementById("chartType").appendChild(genSales);

                    var burgSales = document.createElement("BUTTON");
                    burgSales.innerHTML = "Burger Sales";
                    document.getElementById("chartType").appendChild(burgSales);

                    var specSales = document.createElement("BUTTON");
                    specSales.innerHTML = "Species Sales";
                    document.getElementById("chartType").appendChild(specSales);

                    var BurgBySpec = document.createElement("BUTTON");
                    BurgBySpec.innerHTML = "Burger By Species";
                    document.getElementById("chartType").appendChild(BurgBySpec);

                    var salesByHour = document.createElement("BUTTON");
                    salesByHour.innerHTML = "Sales By Hour";
                    document.getElementById("chartType").appendChild(salesByHour);

                    var salesByDay = document.createElement("BUTTON");
                    salesByDay.innerHTML = "Burger By Species";
                    document.getElementById("chartType").appendChild(salesByDay);


                    var barChart = null;

                    renderGenSales();
                    
                    function renderGenSales () {

                        if (barChart != null) {
                            barChart.destroy();
                        }

                        var allNames = result.sales;

                        console.log(allNames);


                        var customerIDs = Object.keys(allNames);
                        console.log(customerIDs);

                        var customers = [];

                        for(var i = 0; i < customerIDs.length; i++){
                            var custID = allNames[customerIDs[i]];
                            var customer = {customerNum: custID};
                            customers.push(customer);
                        }

                        console.log(customers[1].customerNum); //returns the object from the list


                        

                        var container = document.getElementById("container");
                        var tbl = document.createElement('table');
                        var thead = document.createElement('thead');
                        var tr = document.createElement('tr');


                        tbl.style.width = '100%';
                        tbl.setAttribute('border', '1');

                        $(document).ready(function() {
                            $('#salesTable').DataTable();
                        } );


                    }


                    function renderBurgSales () {

                        if (barChart != null) {
                            barChart.destroy();
                        }

                        var burgersales = result["burger_sales"];
                        var burgersalesQty = [burgersales["Krusty Combo"], burgersales["Krusty Deluxe"], burgersales["Krabby Pattie"]];
                        console.log(burgersalesQty);


                        let myChart = document.getElementById('summary').getContext('2d'); 

                        barChart = new Chart(myChart, {
                            type:'bar',
                            data: {
                                labels: ['Krusty Combo', 'Krusty Deluxe', 'Krabby Pattie'],
                                datasets: [{
                                    label: 'Burger Sales',
                                    data: burgersalesQty
                                }]
                            },
                            options: {}
        
                        });
                    }


                    function renderSpecSales () {

                        if (barChart != null) {
                            barChart.destroy();
                        }

                        var species_sales = result["species_sales"];
                        var salesBySpecies = [species_sales["leatherback turtle"], species_sales["salmon"], species_sales["seahorse"], species_sales["coral"],
                                            species_sales["giant clam"], species_sales["gray whale"], species_sales["sea lion"]];
                        console.log(salesBySpecies);


                        let myChart = document.getElementById('summary').getContext('2d');

                        barChart = new Chart(myChart, {
                            type:'bar',
                            data: {
                                labels: ['Leatherback Turtle', 'Salmon', 'Seahorse', 'Coral', 'Giant Clam', 'Gray Whale', 'Sea Lion'],
                                datasets: [{
                                    label: 'Species Sales',
                                    data: salesBySpecies
                                }]
                            },
                             options: {}
    
                        });

                    }

                    function renderBurgBySpec () {

                        if (barChart != null) {
                            barChart.destroy();
                        }

                        var burger_by_species = result["burger_by_species"];

                        var combo_Byspecies = burger_by_species["Krusty Combo"];
                        var pattie_Byspecies = burger_by_species["Krabby Pattie"];
                        var deluxe_Byspecies = burger_by_species["Krusty Deluxe"];

                        var combo_sales_species = [combo_Byspecies["leatherback turtle"], combo_Byspecies["salmon"], combo_Byspecies["seahorse"], combo_Byspecies["coral"],
                                                    combo_Byspecies["giant clam"], combo_Byspecies["gray whale"], combo_Byspecies["sea lion"]];
                        var pattie_sales_species = [pattie_Byspecies["leatherback turtle"], pattie_Byspecies["salmon"], pattie_Byspecies["seahorse"], pattie_Byspecies["coral"],
                                                    pattie_Byspecies["giant clam"], pattie_Byspecies["gray whale"], pattie_Byspecies["sea lion"]];
                        var deluxe_sales_species = [deluxe_Byspecies["leatherback turtle"], deluxe_Byspecies["salmon"], deluxe_Byspecies["seahorse"], deluxe_Byspecies["coral"],
                                                    deluxe_Byspecies["giant clam"], deluxe_Byspecies["gray whale"], deluxe_Byspecies["sea lion"]];

                        console.log(combo_sales_species);
                        console.log(pattie_sales_species);
                        console.log(deluxe_sales_species);



                        var comboDataset = {
                                    label: 'Krusty Combo Sales',
                                    data: combo_sales_species,
                                    backgroundColor: 'rgba(0, 99, 132, 0.6)'

                        };

                        var deluxeDataset = {
                                    label: 'Krusty Deluxe Sales',
                                    data: deluxe_sales_species,
                                    backgroundColor: 'rgba(99, 132, 0, 0.6)'
                        };

                        var pattieDataset = {
                                    label: 'Krabby Pattie Sales',
                                    data: pattie_sales_species,
                                    backgroundColor: 'rgba(0, 99, 0, 0.6)'
                        };

                        

                        let myChart = document.getElementById('summary').getContext('2d');

                        barChart = new Chart(myChart, {
                            type:'bar',
                            data: {
                                labels: ['Leatherback Turtle', 'Salmon', 'Seahorse', 'Coral', 'Giant Clam', 'Gray Whale', 'Sea Lion'],
                                datasets: [comboDataset, deluxeDataset, pattieDataset]
                            },
                             options: {}
    
                        });
                    }

                    function renderSalesByHour () {

                    }

                    function renderSalesByDay () {

                    }



                    genSales.addEventListener('click', renderGenSales);
                    burgSales.addEventListener('click', renderBurgSales);
                    specSales.addEventListener('click', renderSpecSales);
                    BurgBySpec.addEventListener('click', renderBurgBySpec);
                    salesByHour.addEventListener('click', renderSalesByHour);
                    salesByDay.addEventListener('click', renderSalesByDay);
                };


                fr.readAsText(files.item(0));

                
                

            };

        
        </script>

    
    <div id = "footer"> </div>

</body>

</html>